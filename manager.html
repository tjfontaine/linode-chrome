<!DOCTYPE html>
<html>
  <head>
		<script src="jquery-datalink/jquery.js"></script>
		<script src="jquery-datalink/jquery.datalink.js"></script>
		<script src="jquery-tmpl/jquery.tmpl.js"></script>
		<script src="jquery-tmpl/jquery.tmplPlus.js"></script>
		<script src="jquery.json.js"></script>
		<script src="linode-javascript/linode.api.js"></script>
		<script src="linode-javascript/linode.cache.js"></script>
		<script src="linode-javascript/linode.datalink.js"></script>
		<script src="jquery-ui/ui/jquery.ui.core.js"></script>
  	<script src="jquery-ui/ui/jquery.ui.widget.js"></script>
  	<script src="jquery-ui/ui/jquery.ui.mouse.js"></script>
		<script src="jquery-ui/ui/jquery.ui.tabs.js"></script>
		<script src="ui.tabs.closable/ui.tabs.closable.js"></script>
		<link rel="stylesheet" href="jquery-ui/themes/base/jquery.ui.all.css">
		<style>
		.horizontal_lists li {
			display: inline;
			list-style-type: none;
			padding-right: 20px;
		}
		</style>
		<script type="text/x-jquery-tmpl" id="tmpl_linode_edit">
		<div id="linode-container-${LINODEID}">
  		<form id="linode-${LINODEID}">
  			<ul>
  				<li>Label <input type="text" name="LABEL" value="${LABEL}" size=25 /></li>
  				<li>Display Group <input type="text" name="LPM_DISPLAYGROUP" value="${LPM_DISPLAYGROUP}" /></li>
  				<li>Status <input type="text" name="STATUS" value="${STATUS}" disabled="disabled" size=10 /></li>
  				<li>Ram <input type="text" name="TOTALRAM" value="${TOTALRAM}" disabled="disabled" size=5 /></li>
  				<li>HD <input type="text" name="TOTALHD" value="${TOTALHD}" disabled="disabled" size=5 /></li>
  				<li>BW <input type="text" name="TOTALXFER" value="${TOTALXFER}" disabled="disabled" size=5 /></li>
  				<li>Datacenter <input type="text" name="DATACENTERID" value="${DATACENTERID}" disabled="disabled" /></li>
  				<li>Backups <input type="checkbox" name="BACKUPSENABLED" {{if BACKUPSENABLED}}checked="true"{{/if}} disabled="disabled" /></li>
  				<li>Lassie <input type="checkbox" name="WATCHDOG" {{if WATCHDOG}}checked="true"{{/if}} disabled="disabled" /></li>
  				<li>Alerts
  				  <ul>
  				    <li>Disk <input type="checkbox" name="ALERT_DISKIO_ENABLED" /> Threshold <input type="text" name="ALERT_DISKIO_THRESHOLD" size=10 /></li>
  				    <li>CPU <input type="checkbox" name="ALERT_CPU_ENABLED" /> Threshold <input type="text" name="ALERT_CPU_THRESHOLD" size=10 /></li>
  				    <li>Bandwidth In <input type="checkbox" name="ALERT_BWIN_ENABLED" /> Threshold <input type="text" name="ALERT_BWIN_THRESHOLD" size=10 /></li>
  				    <li>Bandwidth Out <input type="checkbox" name="ALERT_BWOUT_ENABLED" /> Threshold <input type="text" name="ALERT_BWOUT_THRESHOLD" size=10 /></li>
  				    <li>Bandwidth Quota <input type="checkbox" name="ALERT_BWQUOTA_ENABLED" /> Threshold <input type="text" name="ALERT_BWQUOTA_THRESHOLD" size=10 /></li>
  				  </ul>
  				</li>
  				<li><a href="#" class="linode_save">Save</a></li>
  			</ul>
  		</form>
		</div>
		</script>
		<script type="text/x-jquery-tmpl" id="tmpl_linode_list">
		<tr>
		  <td>${LABEL}</td>
		  <td>${$item.statusMap(STATUS)}</td>
		  <td>${DATACENTERID.LOCATION}</td>
		  <td><a href="#" id="linode-edit-${LINODEID}" class="linode_edit">edit</a></td>
		</tr>
		</script>
		<script type="text/x-jquery-tmpl" id="tmpl_domain_list">
	  <tr>
	    <td>${DOMAIN}</td>
	    <td>${SOA_EMAIL}</td>
	  </tr>
		</script>
		<script type="text/javascript">
    $(function()
    {
      var cache = null;
      var keys = localStorage["api_keys"].split(',')
      var apis = []
      function link_item(elm, item) {
        $(elm).link(item, LINODE_OBJ_CONVERSION[item.key])
        for(k in item) {
          $(item).data(k, item[k])
        }
      }
      function iter_objs(shortname, objs) {
        $.each(objs, function(i, obj) {
          var elm = $('#'+shortname+'-'+obj[obj.key])
          link_item(elm, obj)
        })
      }
      $.each(keys, function(i, key)
      {
        if(key && key.length > 1)
        {
          apis.push(new LinodeApi(key))
        }
      })
      cache = new LinodeCache(apis);
      function start()
      {
        var linodes = cache.getAll('LINODEID');
        var domains = cache.getAll('DOMAINID')
        $('#tmpl_linode_list').tmpl(linodes, {
          'statusMap': function(s) {
              return cache.status_map[s.toString()]
            }
          }).appendTo('#linodes')
        $('#tmpl_domain_list').tmpl(domains, {'cache':cache}).appendTo('#domains')
        $('.linode_edit').each(function(i, e){
          $(e).click(function(){
            var id = e.id.replace('linode-edit-', '')
            var linode = cache.get('LINODEID', parseInt(id))
            $('#tmpl_linode_edit').tmpl([linode]).appendTo('#outer_tabs')
            $('#outer_tabs').tabs('add', '#linode-container-'+id, linode.LABEL)
            var pos = $('#outer_tabs').tabs('length')-1
            $('#outer_tabs').tabs('select', pos)
            link_item($('#linode-'+id), linode)
          })
        })
        iter_objs('domain', domains)
      }
      cache.fill(start)
      $('#outer_tabs').tabs({
        closable: true,
        closableClick: function(event, ui) {
          return !$(ui.panel).hasClass('unclosable')
        },
      })
    });

		</script>
  </head>
  <body>
    <div id="outer_tabs">
      <ul>
        <li><a href="#linodes_container">Linodes</a></li>
        <li><a href="#domains_container">Domains</a></li>
      </ul>
  		<div id="linodes_container" class="horizontal_lists unclosable">
  		  <table id="linodes">
  		  </table>
  		</div>
  		<div id="domains_container" class="horizontal_lists unclosable">
  		  <table id="domains">
  		  </table>
  		</div>
	  </div>
  </body>
</html>
